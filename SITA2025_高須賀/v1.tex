% 第42回情報理論とその応用シンポジウム 予稿集 原稿様式
% e-pTeX, Version 3.14159265-p3.7.1-161114-2.6 (utf8.euc) (TeX Live 2017/Debian) (preloaded format=platex)
% 本文: 日本語
\documentclass{jarticle}
\usepackage{sita2021}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{mathtools}
\usepackage[dvipdfmx]{graphicx}
\usepackage{bm}
\usepackage{bbm}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{lscape}
\usepackage{comment}
\usepackage{longtable}
\usepackage{url}
\usepackage[dvipdfmx]{color}
\usepackage{float}
%%%%% Theorem environment 定理環境 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\theoremstyle{definition}
%\theoremsymbol{\ensuremath{\Box}}
\newtheorem{theorem}{定理}
\newtheorem{prop}{命題}
\newtheorem{lemma}{補題}
\newtheorem{cor}{系}
\newtheorem{example}{例}
\newtheorem{definition}{定義}
\newtheorem{rem}{注意}
\newtheorem{guide}{参考}
\newtheorem{assumption}{仮定}
\renewcommand\proofname{\bf 証明}
\newcommand{\halfeq}[2][0.90\linewidth]{%
  \begin{equation}
    \makebox[\linewidth][l]{\resizebox{#1}{!}{\ensuremath{#2}}}%
  \end{equation}
}

\title{
  %和文の論文題目
  構造類似度指標の統合によるSOM気圧配置分類法の一考察\\
  %英文の論文題目
  Synoptic Pattern Classification via Integrated Structural Similarity Metrics in SOM
}
\author{
  %和文の第一著者名
  高須賀匠
  \thanks{ %和文の所属と住所
    〒940-2188 新潟県長岡市上富岡町1603-1 長岡技術科学大学，
    %英文の所属と住所
    Nagaoka University of Technology, 1603-1 Kamitomioka-machi, Nagaoka, Niigata 940-2188, Japan.
  }\\
  %英文の第一著者名
  Takumi Takasuka
  \and
  %第二著者名(和文)
  高野雄紀
  \thanks{
    %和文の所属と住所
    〒305-0052 茨城県つくば市長峰1-1 気象研究所，
    %英文の所属と住所
    Meteorological Research Institute, 1-1 Nagamine, Tsukuba, Ibaraki 305-0052, Japan.
  }\\
  %第二著者名(英文)
  Yuki Takano
  \and
  渡邊正太郎
  \thanks {
    %和文の所属と住所
    〒107-0052 東京都港区赤坂5-4-7 The HEXAGON 5F 株式会社ウェザーマップ，
    %英文の所属と住所
    Weather Map Co., Ltd., The HEXAGON 5F, 5-4-7 Akasaka, Minato-ku, Tokyo 107-0052, Japan.
  }\\
  Shotaro Watanabe
  \and
  雲居玄道
  \footnotemark[1]\\
  Gendo Kumoi
}
\abstract{
This study presents a comprehensive comparison of distance metrics for synoptic pattern classification using Self-Organizing Maps (SOM). We implemented Batch-SOM with four distance metrics: Euclidean (EUC), Structural Similarity Index with $5\times 5$ moving window (SSIM5), Teweles-Wobus score (S1), and their fusion (S1+SSIM5). Using sea level pressure data from the broader Japan region (1991–1999 for training, 2000 for validation), we evaluated classification performance through Macro-averaged Recall and medoid representation quality. Results show that S1+SSIM5 demonstrated superior generalization. We also introduced medoid and true medoid representations to address the blurring effect of centroid averaging, enhancing interpretability of SOM output maps for operational use. This framework bridges recent advances in structural similarity metrics and contributes to future developments in pressure pattern classification.}
\keywords{
  Self-Organizing Map (SOM), synoptic pattern classification, structural similarity metrics
}
\begin{document}
\maketitle

\section{はじめに}
総観規模の気圧配置パターン分類は，気象予報，気候システムの理解，防災・減災など，多様な応用の基盤技術である．従来の主観分類は専門家知見を直接反映できる一方で，労力・再現性・スケーラビリティに課題があるため，客観的・自動的な分類法が広く研究されてきた．教師ありでは，木村ほか\cite{木村広希2009サポートベクターマシンを用いた気圧配置検出手法の提案}がサポートベクターマシン（Support Vector Machine; SVM）により「冬型」「南高北低」「台風型」等の自動検出と検索システムを実装し，実用可能性を示した．しかし，ラベル付与のコストや主観ノイズに起因する学習データ品質の限界が指摘される．教師なしでは，自己組織化マップ（Self-Organizing Map; SOM）が総観パターンの非線形構造を可視化・圧縮する手段として用いられ\cite{philippopoulos2014performance,jiang2013classification}，国内では高須賀ほか\cite{takasuka2024}が$10\times 10$サイズのBatch-SOMにより日本周辺の気圧配置をクラスタリングし，1kmメッシュ天気との結び付けを示した．

従来の多くのSOMやクラスタリングはユークリッド距離（Euclidean）を前提としており，勾配・形状・位置などの「構造」を評価しにくいという制約がある．S-SOM\cite{doan2021s}は最良一致ユニット（Best Matching Unit; BMU）探索に構造類似度指標（Structural Similarity Index Measure; SSIM）を導入してトポロジ保存性を改善した．また，Sato and Kusaka\cite{SATOTakuto20212021-047}は，勾配ベースのS1とSSIMが，Euclideanや単純相関よりも人間の主観的「似ている」をよく再現することを統計的に示した．さらにWinderlichら\cite{winderlich2024classification}は，改良SSIMとmedoid表現により，クラス分離性と代表性を両立する枠組みを提案している．

本研究では，Batch-SOMにおいて，既存手法（単一手法）S1，SSIM5，Euclideanと，提案手法（単一手法）KAPPA，GSSIM，および提案手法（複合手法）S1,KA，GS,KA，S1,GS,KAの計8手法を同一条件で厳密比較する．SOMの代表としてcentroidではなくmedoid（true medoid）を出力して解釈性を高め，学習（1991–1997）と独立検証（1998–2000）の分離により汎化性能を評価する．評価は基本ラベル（15種）のMacro Recallと，ノード多数決（基本ラベル）とmedoid（基本ラベル）の一致率で行う．

\section{提案枠組み}
\subsection{従来手法：バッチ版SOM}
自己組織化マップ（SOM）\cite{kohonen1990self}は教師なし学習によって高次元データを低次元（通常2次元）マップに写像する手法である．オンライン版SOMは1サンプルずつ処理するが，バッチ版SOM（Batch-SOM）は全データまたはミニバッチ単位で処理することで計算効率と収束安定性を向上させる．

本研究では，Graphics Processing Unit（GPU）によるミニバッチ版バッチSOMを実装した\cite{vettigliminisom}．学習アルゴリズムは以下の通りである：

\begin{enumerate}
\item \textbf{初期化}：$M = m_x \times m_y$個のノード（ニューロン）を2次元格子上に配置し，各ノードの重みベクトル$\bm{w}_j \in \mathbb{R}^D$（$j=1,...,M$）をランダムまたはデータからのサンプリングで初期化する．
\item \textbf{ミニバッチ処理}：各反復$t$において，データをサイズ$B$のミニバッチに分割して処理する．
\item \textbf{BMU探索}：各入力$\bm{x}_i$に対して，最良一致ユニット（Best Matching Unit; BMU）を距離関数$d(\cdot, \cdot)$により決定：
\begin{equation}
c(i) = \arg\min_{j} d(\bm{x}_i, \bm{w}_j)
\end{equation}
\item \textbf{近傍関数}：BMU $c(i)$と各ノード$j$間の近傍関数$h_{c(i),j}$を計算．本研究ではガウス関数を使用：
\begin{equation}
h_{c(i),j} = \exp\left(-\frac{\|\bm{r}_{c(i)} - \bm{r}_j\|^2}{2\sigma(t)^2}\right)
\end{equation}
ここで$\bm{r}_j$はノード$j$のグリッド座標，$\sigma(t)$は学習進行に応じて減衰する近傍幅である．
\item \textbf{重み更新}：ミニバッチ内の全サンプルについて分子・分母を累積し，一括更新：
\begin{equation}
\bm{w}_j^{new} = \frac{\sum_{i \in \text{batch}} h_{c(i),j} \bm{x}_i}{\sum_{i \in \text{batch}} h_{c(i),j}}
\end{equation}
\item \textbf{近傍幅の減衰}：$\sigma(t)$は学習全体の進行に応じて単調減少させる．本研究では漸近減衰を採用：
\begin{equation}
\sigma(t) = \frac{\sigma_0}{1 + t/(T/2)}
\end{equation}
ここで$\sigma_0$は初期近傍幅，$T$は総反復回数である．
\end{enumerate}

この枠組みでは，距離関数$d(\cdot, \cdot)$の選択がBMU決定，ひいては学習結果全体に決定的な影響を与える．以下では各距離関数を定義する．

\subsection{距離指標の定義}
入力を各時刻のSLP偏差（hPa）をベクトル化したものとする．$x,w$はそれぞれ入力パターンとノード重みの2次元場（$H\times W$），格子領域を$\Omega$とする．$\varepsilon=10^{-12}$は数値安定化のための微小正値である．

\subsubsection*{既存手法（単一手法）}
\paragraph{Euclidean（ユークリッド距離）}
最も基本的な距離で，値の差の総量を測る：
\begin{equation}
d_{\mathrm{EUC}}(x,w)=\sqrt{\sum_{s\in\Omega}\bigl(x(s)-w(s)\bigr)^2+\varepsilon}
\end{equation}

\paragraph{S1（Teweles-Wobus Score）}
一次差分（勾配）の相対誤差に基づき，前線帯の鋭さ・広がり・配置の一致を測る．加法定数に不変：
\halfeq{%
S1(x,w)=100\times
\frac{\sum\limits_{(i,j)}|\Delta_x^x(i,j)-\Delta_x^w(i,j)|+\sum\limits_{(i,j)}|\Delta_y^x(i,j)-\Delta_y^w(i,j)|}
{\sum\limits_{(i,j)}\max(|\Delta_x^x(i,j)|,|\Delta_x^w(i,j)|)+\sum\limits_{(i,j)}\max(|\Delta_y^x(i,j)|,|\Delta_y^w(i,j)|)+\varepsilon}%
}
ここで$\Delta_x^x(i,j)=x(i,j+1)-x(i,j)$，$\Delta_y^x(i,j)=x(i+1,j)-x(i,j)$，$w$側も同様．

\paragraph{SSIM5（構造類似度指標）}
$5\times 5$の局所窓で平均・分散・共分散を計算し，明るさ・コントラスト・構造の一致度を測る：
\halfeq{%
d_{\mathrm{SSIM5}}(x,w)=1-\frac{1}{|\Omega|}\sum_{s\in\Omega}
\frac{\bigl(2\,\mu_x(s)\mu_w(s)\bigr)\bigl(2\,\operatorname{cov}_{xw}(s)\bigr)}
{\bigl(\mu_x(s)^2+\mu_w(s)^2\bigr)\bigl(\sigma_x^2(s)+\sigma_w^2(s)\bigr)+\varepsilon}%
}
$\mu,\sigma^2,\operatorname{cov}$は$5\times 5$移動窓内の局所統計量，境界はreflectパディング．

\subsubsection*{提案手法（単一手法）}
\paragraph{GSSIM（勾配構造類似度）}
勾配強度と方向（$\cos\theta$）の一致度を，強いエッジほど重く評価：
\halfeq{%
d_{\mathrm{GS}}(x,w)=1-
\frac{\sum\limits_{i,j} \max(G^x,G^w)\;
\frac{2G^xG^w}{(G^x)^2+(G^w)^2+\varepsilon}\;
\tfrac{1}{2}\!\left(1+\frac{g_x^x g_x^w+g_y^x g_y^w}{G^x G^w+\varepsilon}\right)
}{\sum\limits_{i,j}\max(G^x,G^w)+\varepsilon}%
}
$g_x^\cdot,g_y^\cdot$は内部格子の一次差分，$G^\cdot=\sqrt{(g_x^\cdot)^2+(g_y^\cdot)^2+\varepsilon}$．

\paragraph{KAPPA（曲率距離）}
正規化勾配の発散（曲率）から等圧線の曲がり（凹凸・渦の閉じ具合）を比較：
\halfeq{%
d_{\mathrm{KA}}(x,w)=\tfrac{1}{2}\times
\frac{\sum\limits_{i,j}\bigl|\kappa(x)(i,j)-\kappa(w)(i,j)\bigr|}
{\sum\limits_{i,j}\max\!\bigl(|\kappa(x)(i,j)|,|\kappa(w)(i,j)|\bigr)+\varepsilon}%
}
$\kappa(z)=\nabla\cdot\left(\nabla z/(\|\nabla z\|+\varepsilon)\right)$は中心差分の内部共通格子で評価．

\subsubsection*{提案手法（複合手法）}
複合手法は，複数の距離指標を行方向（入力$x$固定，候補$w$方向）min-max正規化を介したRoot Mean Square（RMS）統合により組み合わせる．これにより各指標のスケール差を吸収し，複数の視点から類似性を評価できる．

\paragraph{S1,KA}
S1（勾配の鋭さ）とKAPPA（曲率）を統合：
\begin{align}
\tilde d_{\mathrm{S1}}(x,w)&=\frac{d_{\mathrm{S1}}(x,w)-\min_{w'}d_{\mathrm{S1}}(x,w')}{\max_{w'}d_{\mathrm{S1}}(x,w')-\min_{w'}d_{\mathrm{S1}}(x,w')+\varepsilon}\\
\tilde d_{\mathrm{KA}}(x,w)&=\frac{d_{\mathrm{KA}}(x,w)-\min_{w'}d_{\mathrm{KA}}(x,w')}{\max_{w'}d_{\mathrm{KA}}(x,w')-\min_{w'}d_{\mathrm{KA}}(x,w')+\varepsilon}\\
d_{\mathrm{S1,KA}}(x,w)&=\sqrt{\frac{\tilde d_{\mathrm{S1}}(x,w)^2+\tilde d_{\mathrm{KA}}(x,w)^2}{2}}
\end{align}

\paragraph{GS,KA}
GSSIM（エッジの強さ・向き）とKAPPA（曲率）を統合：
\begin{equation}
d_{\mathrm{GS,KA}}(x,w)=\sqrt{\frac{d_{\mathrm{GS}}(x,w)^2+\tilde d_{\mathrm{KA}}(x,w)^2}{2}}
\end{equation}

\paragraph{S1,GS,KA}
S1（鋭さ）・GSSIM（方向）・KAPPA（曲率）の三要素を総合：
\begin{equation}
d_{\mathrm{S1,GS,KA}}(x,w)=\sqrt{\frac{\tilde d_{\mathrm{S1}}(x,w)^2+d_{\mathrm{GS}}(x,w)^2+\tilde d_{\mathrm{KA}}(x,w)^2}{3}}
\end{equation}

\subsection{Medoid表現}
SOMの各ノードの代表パターンとして，従来はcentroid（割り当てられたサンプルの平均）が使用されるが，平均化により勾配が平滑化される問題がある．そこで本研究では，各ノードに割り当てられたインデックス集合$I_c$に対し，ノード内総距離
\begin{equation}
\mathrm{cost}(i)=\sum_{j\in I_c} d\bigl(X_j, X_i\bigr)
\end{equation}
が最小となる実サンプル$X_{i^\star}$（$i^\star=\arg\min_{i\in I_c}\mathrm{cost}(i)$）をそのノードのtrue medoidとする．これにより実データの鋭さを保持した代表パターンが得られる．

\subsection*{数式内の変数説明}
\begin{itemize}
\item $x,w$：入力パターンとノード重み（$H\times W$の格子場）
\item $\Omega$：格子領域の添字集合，$|\Omega|$は格子点数
\item $\mu_x(s),\mu_w(s)$：画素$s$近傍（$5\times 5$）での局所平均
\item $\sigma_x^2(s),\sigma_w^2(s)$：同局所分散
\item $\operatorname{cov}_{xw}(s)$：同局所共分散
\item $\Delta_x^\cdot,\Delta_y^\cdot$：水平方向・鉛直方向の一次差分
\item $g_x^\cdot,g_y^\cdot$：内部共通格子での勾配成分，$G^\cdot$：勾配強度
\item $\bm{n}$：正規化勾配ベクトル，$\kappa(z)=\nabla\cdot\bm{n}$（中心差分）
\item $\varepsilon$：数値安定化の微小正値（$10^{-12}$）
\end{itemize}

\section{実験設定}
\subsection{データと前処理}
\begin{itemize}
\item \textbf{物理量}：海面更正気圧（SLP）
\item \textbf{領域}：日本周辺域（15–55°N, 115–155°E）
\item \textbf{期間}：学習1991–1997年，検証1998–2000年（日次09 Japan Standard Time; JST）
\item \textbf{ラベル}：吉野\cite{吉野2002日本の気候}の付録B「気圧配置ごよみ」準拠
\item \textbf{前処理}：PaからhPaへ変換後，領域平均を引く．
\end{itemize}
\subsection{ラベル体系の詳細}
本研究で用いるラベル体系は，吉野\cite{吉野2002日本の気候}の付録B「気圧配置ごよみ」に準拠する．以下に主要な基本型（1〜6，計15基本型）と複合的な型（複合型）を示す．

\begin{description}
\item[1. 西高東低冬型] 冬季に特徴的なシベリア高気圧とアリューシャン低気圧に起因する西高東低の場．

\begin{figure}[H] \centering \includegraphics[width=0.6\columnwidth,keepaspectratio]{fig/slp_anom_19910109.png} \caption{西高東低冬型（ラベル:1）の例} \label{fig:slp_anom_19910109} \end{figure}

\item[2. 気圧の谷型] 低気圧あるいは気圧の谷の通過に対応する型．サブタイプは次の通り：
  \begin{description}
    \item[A.] 低気圧が北海道またはサハリン付近を東に進む．
    \item[B.] 低気圧が日本海から北東に進む．
    \item[C.] 低気圧が台湾から日本の太平洋岸を東〜東北東に進む．
    \item[D.] 二つ玉低気圧，または日本海と太平洋に低圧部．
  \end{description}

\begin{figure}[H] \centering \includegraphics[width=0.6\columnwidth,keepaspectratio]{fig/slp_anom_19941001.png} \caption{気圧の谷型（ラベル:2A）の例} \label{fig:slp_anom_19941001} \end{figure}

\item[3. 移動性高気圧型] 移動性高気圧に覆われる型．サブタイプは次の通り：
  \begin{description}
    \item[A.] 日本の北方または北部を東に進む．
    \item[B.] 日本列島上（主として本州上）を東に進む．
    \item[C.] 帯状高気圧．
    \item[D.] 日本の太平洋岸または南方を東に進む．
  \end{description}

\begin{figure}[H] \centering \includegraphics[width=0.6\columnwidth,keepaspectratio]{fig/slp_anom_19920406.png} \caption{移動性高気圧型（ラベル:3A）の例} \label{fig:slp_anom_19920406} \end{figure}

\item[4. 前線型] 停滞性の前線が卓越する型．サブタイプは次の通り：
  \begin{description}
    \item[A.] 日本列島上をほぼ東西方向に走る主として停滞性の前線．
    \item[B.] 太平洋岸または日本南方をほぼ東西方向に走る主として停滞性の前線．
  \end{description}

\begin{figure}[H] \centering \includegraphics[width=0.6\columnwidth,keepaspectratio]{fig/slp_anom_19930707.png} \caption{前線型（ラベル:4A）の例} \label{fig:slp_anom_19930707} \end{figure}

\item[5. 南高北低夏型] 原則として北太平洋高気圧が日本列島を支配する夏型．

\begin{figure}[H] \centering \includegraphics[width=0.6\columnwidth,keepaspectratio]{fig/slp_anom_19990728.png} \caption{南高北低夏型（ラベル:5）の例} \label{fig:slp_anom_19990728} \end{figure}

\item[6. 台風型] 台風の位置に応じて次のサブタイプに区分：
  \begin{description}
    \item[A.] 台風が南九州より南方の海上にある場合．
    \item[B.] 台風が本州およびその接岸地帯にある場合．
    \item[C.] 台風が北日本にある場合．
  \end{description}

\begin{figure}[H] \centering \includegraphics[width=0.6\columnwidth,keepaspectratio]{fig/slp_anom_19910819.png} \caption{台風型（ラベル:6A）の例} \label{fig:slp_anom_19910819} \end{figure}
  
\item[移行型] 例えば「3A - 2D」のように，異なる基本型間の移行過程を示す型．
\item[複合型] 例えば「2A + 2C」のように，複数の型が同時に現れる複合的な場．
\end{description}

実験では，1〜6のサブタイプまでの15個の型を「基本型」とし，評価指標の「基本ラベル」に用いる．一方で複合的な型は評価に含めない設定とした（詳細の定義は吉野\cite{吉野2002日本の気候}を参照）．

\subsection{SOM設定と学習条件}
\begin{itemize}
\item マップサイズ：$10\times 10$
\item 反復回数：$1000$，バッチサイズ：$128$
\item 近傍関数：ガウス関数，初期$\sigma=2.5$（学習全体で減衰）
\item 学習率：$0.5$
\end{itemize}

\subsection{評価指標}
\begin{itemize}
\item Macro Recall（基本ラベル）：各基本ラベルの再現率の平均．混同行列は「基本ラベル vs クラスタ列」で集計．
\item NodewiseMatchRate（基本）：各ノードの多数決（基本ラベル）とtrue medoidの基本ラベルの一致率．
\end{itemize}
学習期および独立検証期に対して算出する．

\section{実験結果}
本節では，シード値1〜50で50回試行した集計結果を示す．まず，手法別のMacro Recall（学習・検証）およびNodewiseMatchRate（学習）の要約統計を同一表（表\ref{tab:macro_nodewise_summary}）にまとめて示す．続いて，基本ラベルごとの平均再現率の横断ピボット表を，学習（表\ref{tab:pivot_train}）と検証（表\ref{tab:pivot_valid}）でそれぞれ提示する（表が大きいため横向き・大判で示す）．

50試行において学習期のMacro RecallはS1,KA／S1,GS,KA／GS,KAが0.37 ± 0.02で同等の上位値を示した（標準偏差を考慮すると統計的に有意な差は認められない）．一方，検証期ではS1,KAが0.23 ± 0.02でやや高く，次点のS1,GS,KA（0.22 ± 0.02）と比較して1標準偏差の半分程度の差があることから，実用上はS1,KAが汎化性能において優位と判断できる．NodewiseMatchRate（学習）は複合手法のスコアが低い．

ラベル別では学習期の台風系6AでS1,KAのRecallが0.61と突出し，6BはS1が相対的に良好であった．ただし検証期の6A/6B/6Cはいずれも再現率が極めて低く，稀少クラスの課題が顕著だった．ERA5の基本ラベル分布が大きく不均衡（例：1=10.3%，3B=8.8%，6A=0.19%，6C=0.055%）で，複合ラベルが約52.7%を占めることがこの傾向の一因である．以上より，実運用ではS1,KAを標準距離としつつ，代表整合の確認にEuclideanを併用する構成が妥当と考える（表\ref{tab:macro_nodewise_summary}）．


\begin{table}[!ht]
\centering
\caption{手法別 Macro Recall（学習・検証）と NodewiseMatchRate（学習）の統計量（平均±標準偏差, N=50）}
\label{tab:macro_nodewise_summary}
\resizebox{0.95\linewidth}{!}{
\begin{tabular}{lccc}
\hline
Method & Macro Recall（学習） & Macro Recall（検証） & NodewiseMatchRate（学習） \\
\hline
S1,KA      & 0.37 ± 0.02 & 0.23 ± 0.02 & 0.25 ± 0.03 \\
S1,GS,KA   & 0.37 ± 0.02 & 0.22 ± 0.02 & 0.24 ± 0.04 \\
GS,KA      & 0.37 ± 0.02 & 0.21 ± 0.01 & 0.25 ± 0.05 \\
S1         & 0.36 ± 0.02 & 0.21 ± 0.02 & 0.26 ± 0.04 \\
GSSIM      & 0.35 ± 0.02 & 0.21 ± 0.02 & 0.27 ± 0.04 \\
SSIM5      & 0.32 ± 0.02 & 0.17 ± 0.01 & 0.29 ± 0.04 \\
Euclidean  & 0.30 ± 0.02 & 0.18 ± 0.01 & 0.31 ± 0.03 \\
KAPPA      & 0.30 ± 0.01 & 0.21 ± 0.02 & 0.29 ± 0.03 \\
\hline
\end{tabular}
}
\end{table}

\clearpage
\begin{landscape}
\begin{table}[t]
\centering
\caption{横断ピボット表（学習: 基本ラベルごとの平均再現率）}
\label{tab:pivot_train}
\scriptsize
\setlength{\tabcolsep}{4pt}
\resizebox{0.90\linewidth}{!}{
\begin{tabular}{lcccccccccccccccccc}
\hline
Method & 1 & 2A & 2B & 2C & 2D & 3A & 3B & 3C & 3D & 4A & 4B & 5 & 6A & 6B & 6C & Overall & N\_lab \\
\hline
S1,KA      & 0.92 & 0.26 & 0.24 & 0.14 & 0.60 & 0.21 & 0.79 & 0.05 & 0.01 & 0.68 & 0.35 & 0.59 & 0.61 & 0.10 & 0.00 & 0.37 & 15 \\
S1,GS,KA   & 0.91 & 0.35 & 0.27 & 0.07 & 0.61 & 0.20 & 0.79 & 0.08 & 0.02 & 0.66 & 0.34 & 0.59 & 0.45 & 0.17 & 0.00 & 0.37 & 15 \\
GS,KA      & 0.90 & 0.32 & 0.27 & 0.07 & 0.62 & 0.21 & 0.79 & 0.07 & 0.02 & 0.66 & 0.35 & 0.63 & 0.41 & 0.17 & 0.00 & 0.37 & 15 \\
S1         & 0.91 & 0.29 & 0.21 & 0.13 & 0.61 & 0.22 & 0.77 & 0.05 & 0.02 & 0.66 & 0.37 & 0.54 & 0.49 & 0.20 & 0.00 & 0.36 & 15 \\
GSSIM      & 0.91 & 0.27 & 0.18 & 0.09 & 0.59 & 0.19 & 0.75 & 0.06 & 0.02 & 0.63 & 0.31 & 0.55 & 0.56 & 0.18 & 0.00 & 0.35 & 15 \\
SSIM5      & 0.90 & 0.13 & 0.07 & 0.17 & 0.45 & 0.22 & 0.70 & 0.06 & 0.16 & 0.59 & 0.36 & 0.44 & 0.42 & 0.14 & 0.04 & 0.32 & 15 \\
Euclidean  & 0.91 & 0.22 & 0.12 & 0.05 & 0.48 & 0.35 & 0.74 & 0.05 & 0.14 & 0.57 & 0.22 & 0.33 & 0.34 & 0.06 & 0.00 & 0.30 & 15 \\
KAPPA      & 0.88 & 0.25 & 0.22 & 0.10 & 0.45 & 0.06 & 0.78 & 0.07 & 0.01 & 0.68 & 0.26 & 0.62 & 0.04 & 0.04 & 0.00 & 0.30 & 15 \\
\hline
\end{tabular}
}
\end{table}

\begin{table}[t]
\centering
\caption{横断ピボット表（検証: 基本ラベルごとの平均再現率）}
\label{tab:pivot_valid}
\scriptsize
\setlength{\tabcolsep}{4pt}
\resizebox{0.90\linewidth}{!}{
\begin{tabular}{lcccccccccccccccccc}
\hline
Method & 1 & 2A & 2B & 2C & 2D & 3A & 3B & 3C & 3D & 4A & 4B & 5 & 6A & 6B & 6C & Overall & N\_lab \\
\hline
S1,KA      & 0.91 & 0.21 & 0.03 & 0.00 & 0.57 & 0.00 & 0.80 & 0.00 & 0.00 & 0.73 & 0.08 & 0.09 & 0.00 & 0.00 & 0.00 & 0.23 & 15 \\
S1,GS,KA   & 0.92 & 0.20 & 0.02 & 0.00 & 0.45 & 0.02 & 0.80 & 0.00 & 0.00 & 0.64 & 0.08 & 0.12 & 0.00 & 0.01 & 0.00 & 0.22 & 15 \\
GSSIM      & 0.93 & 0.09 & 0.02 & 0.00 & 0.48 & 0.02 & 0.78 & 0.00 & 0.00 & 0.53 & 0.10 & 0.14 & 0.00 & 0.11 & 0.00 & 0.21 & 15 \\
GS,KA      & 0.93 & 0.14 & 0.04 & 0.00 & 0.44 & 0.03 & 0.79 & 0.00 & 0.00 & 0.62 & 0.08 & 0.14 & 0.00 & 0.00 & 0.00 & 0.21 & 15 \\
S1         & 0.95 & 0.04 & 0.01 & 0.00 & 0.53 & 0.01 & 0.77 & 0.00 & 0.00 & 0.65 & 0.06 & 0.08 & 0.02 & 0.04 & 0.00 & 0.21 & 15 \\
KAPPA      & 0.91 & 0.15 & 0.00 & 0.00 & 0.31 & 0.00 & 0.73 & 0.00 & 0.00 & 0.74 & 0.05 & 0.20 & 0.00 & 0.00 & 0.00 & 0.21 & 15 \\
Euclidean  & 0.86 & 0.04 & 0.00 & 0.00 & 0.29 & 0.00 & 0.83 & 0.00 & 0.00 & 0.66 & 0.01 & 0.01 & 0.00 & 0.00 & 0.00 & 0.18 & 15 \\
SSIM5      & 0.86 & 0.00 & 0.00 & 0.01 & 0.28 & 0.00 & 0.78 & 0.00 & 0.00 & 0.52 & 0.08 & 0.05 & 0.00 & 0.00 & 0.00 & 0.17 & 15 \\
\hline
\end{tabular}
}
\end{table}
\end{landscape}

\section{考察}
\subsection{手法の特性と補完性}
S1は勾配差の比率に基づき前線帯や冬型で有効．SSIM5は局所構造（形状・位置・コントラスト）を評価．GSSIMは勾配強度と方向の両面を重み付きで評価．KAPPAは等圧面の曲率構造に注目する．複合（S1,KA／GS,KA／S1,GS,KA）はこれらの利点をRMS統合で併合し，BMU探索における汎化を支える．

\subsection{Medoid表現の有効性}
centroidは平均化により勾配が平滑化されやすい一方，medoidは実データ実現値を代表として保持し，解釈性と検索性を高める．本実装では標準でtrue medoidを算出する．

\subsection{汎化性能の解釈}
S1は勾配差に敏感，KAPPAは曲率（幾何）を評価するため，S1,KAは形状と鋭さを同時に捉えBMU探索の頑健性を高める．その結果，検証Macro Recallで最良を示した．一方，NodewiseMatchRateではEuclideanが最大であり，ノード内多数決とmedoidラベルの一致を生みやすい（振幅差に整合）．用途により，識別（Macro Recall）優先か，ノード代表性（一致率）優先かで距離の使い分けが必要である．

\subsection{ラベル不均衡と評価設計}
台風系（6A/6B/6C）は出現頻度が極端に低く，さらに複合場が約半数を占めるため，検証で再現率が低下しやすい．季節別SOM（冬・梅雨・台風季）や階層的分類（大局型→サブタイプ），外部事象フラグの併用（台風客観解析）により稀少クラスの頑健性を補うことができる．

\section{まとめ}
Batch-SOM上で，既存手法（S1，SSIM5，Euclidean）と提案手法（KAPPA，GSSIM，S1,KA，GS,KA，S1,GS,KA）の8手法を同一条件で比較できる実験枠組みを構築した．実装に準拠した厳密な数式定義を提示し，評価は基本ラベルに対するMacro Recallとノード代表一致率で行った．centroidの代わりにmedoidを採用することで代表パターンの鋭さを保持できる．S1,KAのスコアが高く実務ではS1,KAの運用が望ましい．今後は多変量拡張，季節別最適化，および循環統計の総合評価（例：Jensen–Shannon距離）への発展を予定する．

\bibliographystyle{sieicej}
\bibliography{ref}
\end{document}
