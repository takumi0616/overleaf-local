% 第42回情報理論とその応用シンポジウム 予稿集 原稿様式
% e-pTeX, Version 3.14159265-p3.7.1-161114-2.6 (utf8.euc) (TeX Live 2017/Debian) (preloaded format=platex)
% 本文: 日本語
\documentclass{jarticle}
\usepackage{sita2021}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{mathtools}
\usepackage[dvipdfmx]{graphicx}
\usepackage{bm}
\usepackage{bbm}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{lscape}
\usepackage{comment}
\usepackage{longtable}
\usepackage{url}
\usepackage[dvipdfmx]{color}
%%%%% Theorem environment 定理環境 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\theoremstyle{definition}
%\theoremsymbol{\ensuremath{\Box}}
\newtheorem{theorem}{定理}
\newtheorem{prop}{命題}
\newtheorem{lemma}{補題}
\newtheorem{cor}{系}
\newtheorem{example}{例}
\newtheorem{definition}{定義}
\newtheorem{rem}{注意}
\newtheorem{guide}{参考}
\newtheorem{assumption}{仮定}
\renewcommand\proofname{\bf 証明}
\newcommand{\halfeq}[2][0.85\linewidth]{%
  \begin{equation}
    \makebox[\linewidth][l]{\resizebox{#1}{!}{\ensuremath{#2}}}%
  \end{equation}
}

\title{
  %和文の論文題目
  構造類似度指標の統合によるSOM気圧配置分類法の一考察\\
  %英文の論文題目
  Synoptic Pattern Classification via Integrated Structural Similarity Metrics in SOM
}
\author{
  %和文の第一著者名
  高須賀匠
  \thanks{ %和文の所属と住所
    〒940-2188 新潟県長岡市上富岡町1603-1 長岡技術科学大学，
    %英文の所属と住所
    Nagaoka University of Technology, 1603-1 Kamitomioka-machi, Nagaoka, Niigata 940-2188, Japan.
  }\\
  %英文の第一著者名
  Takumi Takasuka
  \and
  %第二著者名(和文)
  高野雄紀
  \thanks{
    %和文の所属と住所
    〒305-0052 茨城県つくば市長峰1-1 気象研究所，
    %英文の所属と住所
    Meteorological Research Institute, 1-1 Nagamine, Tsukuba, Ibaraki 305-0052, Japan.
  }\\
  %第二著者名(英文)
  Yuki Takano
  \and
  渡邊正太郎
  \thanks {
    %和文の所属と住所
    〒107-0052 東京都港区赤坂5-4-7 The HEXAGON 5F 株式会社ウェザーマップ，
    %英文の所属と住所
    Weather Map Co., Ltd., The HEXAGON 5F, 5-4-7 Akasaka, Minato-ku, Tokyo 107-0052, Japan.
  }\\
  Shotaro Watanabe
  \and
  雲居玄道
  \samethanks{1}\\
  Gendo Kumoi
}
\abstract{
This study presents a comprehensive comparison of distance metrics for synoptic pattern classification using Self-Organizing Maps (SOM). We implemented Batch-SOM with four distance metrics: Euclidean (EUC), Structural Similarity Index with 5×5 moving window (SSIM5), Teweles-Wobus score (S1), and their fusion (S1+SSIM5). Using sea level pressure data from the broader Japan region (1991-1999 for training, 2000 for validation), we evaluated classification performance through Macro-averaged Recall and medoid representation quality. Results show that S1+SSIM5 demonstrated superior generalization. We also introduced medoid and true-medoid representations to address the "blurring" effect of centroid averaging, enhancing interpretability of SOM output maps for operational use. This framework bridges recent advances in structural similarity metrics and contributes to future developments in pressure pattern classification.}
\keywords{
  Self-Organizing Map (SOM), synoptic pattern classification, structural similarity metrics
}
\begin{document}
\maketitle

\section{はじめに}
総観規模の気圧配置パターン分類は，気象予報，気候システムの理解，防災・減災など，多様な応用の基盤技術である．従来の主観分類は専門家知見を直接反映できる一方で，労力・再現性・スケーラビリティに課題があるため，客観的・自動的な分類法が広く研究されてきた．教師ありでは，木村ほか\cite{木村広希2009サポートベクターマシンを用いた気圧配置検出手法の提案}がSVMにより「冬型」「南高北低」「台風型」等の自動検出と検索システムを実装し，実用可能性を示した．しかし，ラベル付与のコストや主観ノイズに起因する学習データ品質の限界が指摘される．教師なしでは，SOM（Self-Organizing Map）が総観パターンの非線形構造を可視化・圧縮する手段として用いられ\cite{philippopoulos2014performance,jiang2013classification}，国内では筆者である高須賀ほか\cite{takasuka2024}が10×10 サイズのbatchSOMにより日本周辺の気圧配置をクラスタリングし，1kmメッシュ天気との結び付けを示した．

従来の多くのSOMやクラスタリングはEUCLIDEANを前提としており，勾配・形状・位置などの「構造」を評価しにくいという制約がある．S-SOM\cite{doan2021s}はBMU探索に構造類似度指標（SSIM）を導入してトポロジ保存性を改善した．また，Sato and Kusaka\cite{SATOTakuto20212021-047}は，勾配ベースのS1とSSIMが，EUCLIDEANや単純相関よりも人間の主観的「似ている」をよく再現することを統計的に示した．さらにWinderlichら\cite{winderlich2024classification}は，改良SSIMとmedoid表現により，クラス分離性と代表性を両立する枠組みを提案している．

本研究は，Batch-SOMにおいて，既存手法（単一手法）S1，SSIM5，EUCLIDEANと，提案手法（単一手法）KAPPA，GSSIM，および提案手法（複合手法）S1,KA，GS,KA，S1,GS,KAの計8手法を同一条件で厳密比較する．SOMの代表としてcentroidではなくmedoid（true medoid）を出力して解釈性を高め，学習（1991–1997）と独立検証（1998–2000）の分離により汎化性能を評価する．評価は基本ラベル（15種）のMacro Recallと，ノード多数決（基本ラベル）とmedoid（基本ラベル）の一致率で行う．

\section{提案枠組み}
\subsection{Batch-SOM}
バッチ版SOMをGPUで実装した．各イテレーションで，ミニバッチごとにBMUを探索し，近傍関数$h_{ij}$により分子・分母を蓄積して一括更新する．近傍幅$\sigma$は学習全体の進行$t$に応じて減衰（非増加）させる．入力は各時刻のSLP偏差（hPa）をベクトル化したものである．

\subsection{距離（類似度）指標の分類と定義}
本稿では，手法を次のように紹介・使用する．
\begin{itemize}
  \item 既存手法（単一手法）：S1／ SSIM5／ EUCLIDEAN
  \item 提案手法（単一手法）：KAPPA／ GSSIM
  \item 提案手法（複合手法）：\textbf{S1,KA}／ \textbf{GS,KA}／ \textbf{S1,GS,KA}
\end{itemize}

以下，正式名称で数式定義を与える．$x,w$は入力パターンとノード重みの2次元場（$H\times W$），格子領域を$\Omega$，$\varepsilon=10^{-12}$とする．

\subsubsection*{既存手法（単一手法）}
\paragraph{S1}
\halfeq[0.90\linewidth]{%
S1(x,w)=100\times
\frac{\sum\limits_{(i,j)}|\Delta_x^x(i,j)-\Delta_x^w(i,j)|+\sum\limits_{(i,j)}|\Delta_y^x(i,j)-\Delta_y^w(i,j)|}
{\sum\limits_{(i,j)}\max(|\Delta_x^x(i,j)|,|\Delta_x^w(i,j)|)+\sum\limits_{(i,j)}\max(|\Delta_y^x(i,j)|,|\Delta_y^w(i,j)|)+\varepsilon}%
}
ここで$\Delta_x^x(i,j)=x(i,j+1)-x(i,j)$，$\Delta_y^x(i,j)=x(i+1,j)-x(i,j)$，$w$側も同様．

\paragraph{SSIM5}
\halfeq[0.90\linewidth]{%
d_{\mathrm{SSIM5}}(x,w)=1-\frac{1}{|\Omega|}\sum_{s\in\Omega}
\frac{\bigl(2\,\mu_x(s)\mu_w(s)\bigr)\bigl(2\,\operatorname{cov}_{xw}(s)\bigr)}
{\bigl(\mu_x(s)^2+\mu_w(s)^2\bigr)\bigl(\sigma_x^2(s)+\sigma_w^2(s)\bigr)+\varepsilon}%
}
$\mu,\sigma^2,\operatorname{cov}$は5×5移動平均，境界はreflect．

\paragraph{EUCLIDEAN}
\begin{equation}
d_{\mathrm{EUC}}(x,w)=\sqrt{\sum_{s\in\Omega}\bigl(x(s)-w(s)\bigr)^2+\varepsilon}.
\end{equation}

\subsubsection*{提案手法（単一手法）}
\paragraph{KAPPA}
\halfeq[0.90\linewidth]{%
d_{\mathrm{KA}}(x,w)=\tfrac{1}{2}\times
\frac{\sum\limits_{i,j}\bigl|\kappa(x)(i,j)-\kappa(w)(i,j)\bigr|}
{\sum\limits_{i,j}\max\!\bigl(|\kappa(x)(i,j)|,|\kappa(w)(i,j)|\bigr)+\varepsilon}%
}
$\kappa(z)=\nabla\cdot\left(\nabla z/(\|\nabla z\|+\varepsilon)\right)$は中心差分の内部共通格子で評価．

\paragraph{GSSIM}
\halfeq[0.90\linewidth]{%
d_{\mathrm{GS}}(x,w)=1-
\frac{\sum\limits_{i,j} \max(G^x,G^w)\;
\frac{2G^xG^w}{(G^x)^2+(G^w)^2+\varepsilon}\;
\tfrac{1}{2}\!\left(1+\frac{g_x^x g_x^w+g_y^x g_y^w}{G^x G^w+\varepsilon}\right)
}{\sum\limits_{i,j}\max(G^x,G^w)+\varepsilon}%
}
$g_x^\cdot,g_y^\cdot$は内部格子の一次差分，$G^\cdot=\sqrt{(g_x^\cdot)^2+(g_y^\cdot)^2+\varepsilon}$．

\subsubsection*{提案手法（複合手法）}
複合手法は行方向（入力$x$固定，候補$w$方向）min–max正規化を介したRMS統合である．
\paragraph{S1,KA}
\begin{align}
\tilde d_{\mathrm{S1}}(x,w)&=\frac{d_{\mathrm{S1}}(x,w)-\min_{w'}d_{\mathrm{S1}}(x,w')}{\max_{w'}d_{\mathrm{S1}}(x,w')-\min_{w'}d_{\mathrm{S1}}(x,w')+\varepsilon},\\
\tilde d_{\mathrm{KA}}(x,w)&=\frac{d_{\mathrm{KA}}(x,w)-\min_{w'}d_{\mathrm{KA}}(x,w')}{\max_{w'}d_{\mathrm{KA}}(x,w')-\min_{w'}d_{\mathrm{KA}}(x,w')+\varepsilon},\\
d_{\mathrm{S1,KA}}(x,w)&=\sqrt{\frac{\tilde d_{\mathrm{S1}}(x,w)^2+\tilde d_{\mathrm{KA}}(x,w)^2}{2}}.
\end{align}

\paragraph{GS,KA}
\begin{equation}
\begin{aligned}
\tilde d_{\mathrm{KA}}(x,w)
&=\frac{d_{\mathrm{KA}}(x,w)-\min_{w'}d_{\mathrm{KA}}(x,w')}{\max_{w'}d_{\mathrm{KA}}(x,w')-\min_{w'}d_{\mathrm{KA}}(x,w')+\varepsilon},\\
d_{\mathrm{GS,KA}}(x,w)
&=\sqrt{\frac{d_{\mathrm{GS}}(x,w)^2+\tilde d_{\mathrm{KA}}(x,w)^2}{2}}.
\end{aligned}
\end{equation}

\paragraph{S1,GS,KA}
\begin{equation}
d_{\mathrm{S1,GS,KA}}(x,w)=\sqrt{\frac{\tilde d_{\mathrm{S1}}(x,w)^2+d_{\mathrm{GS}}(x,w)^2+\tilde d_{\mathrm{KA}}(x,w)^2}{3}}.
\end{equation}

\subsection{Medoid（true medoid）表現}
SOMの各ノードに割り当てられたインデックス集合$I_c$に対し，ノード内総距離
\begin{equation}
\mathrm{cost}(i)=\sum_{j\in I_c} d\bigl(X_j, X_i\bigr)
\end{equation}
が最小となる実サンプル$X_{i^\star}$（$i^\star=\arg\min_{i\in I_c}\mathrm{cost}(i)$）をそのノードのtrue medoidとする．$d(\cdot,\cdot)$は上記いずれかの距離である．

\section{実験設定}
\subsection{データと前処理}
\begin{itemize}
\item \textbf{物理量}：海面更正気圧（SLP）
\item \textbf{領域}：東アジア域（15-55°N, 115-155°E）
\item \textbf{期間}：学習1991-1999年，検証2000年（日次09JST）
\item \textbf{ラベル}：参考文献\cite{吉野2002日本の気候}の付録B「気圧配置ごよみ」準拠
\item \textbf{前処理}：Pa→hPa変換後，領域平均を引く．
\end{itemize}
\subsection{データのラベル詳細}
本研究で用いるラベル体系は，参考文献\cite{吉野2002日本の気候}の付録B「気圧配置ごよみ」に準拠する．以下に主要な基本型（1〜6，計15基本型）と複合的な型（複合型）を示す．

\begin{description}
\item[1. 西高東低冬型] 冬季に特徴的なシベリア高気圧とアリューシャン低気圧に起因する西高東低の場．
\item[2. 気圧の谷型] 低気圧あるいは気圧の谷の通過に対応する型．サブタイプは次の通り：
  \begin{description}
    \item[A.] 低気圧が北海道またはサハリン付近を東に進む．
    \item[B.] 低気圧が日本海から北東に進む．
    \item[C.] 低気圧が台湾から日本の太平洋岸を東〜東北東に進む．
    \item[D.] 二つ玉低気圧，または日本海と太平洋に低圧部．
  \end{description}
\item[3. 移動性高気圧型] 移動性高気圧に覆われる型．サブタイプは次の通り：
  \begin{description}
    \item[A.] 日本の北方または北部を東に進む．
    \item[B.] 日本列島上（主として本州上）を東に進む．
    \item[C.] 帯状高気圧．
    \item[D.] 日本の太平洋岸または南方を東に進む．
  \end{description}
\item[4. 前線型] 停滞性の前線が卓越する型．サブタイプは次の通り：
  \begin{description}
    \item[A.] 日本列島上をほぼ東西方向に走る主として停滞性の前線．
    \item[B.] 太平洋岸または日本南方をほぼ東西方向に走る主として停滞性の前線．
  \end{description}
\item[5. 南高北低夏型] 原則として北太平洋高気圧が日本列島を支配する夏型．
\item[6. 台風型] 台風の位置に応じて次のサブタイプに区分：
  \begin{description}
    \item[A.] 台風が南九州より南方の海上にある場合．
    \item[B.] 台風が本州およびその接岸地帯にある場合．
    \item[C.] 台風が北日本にある場合．
  \end{description}
\item[移行型] 例えば「3A - 2D」のように，異なる基本型間の移行過程を示す型．
\item[複合型] 例えば「2A + 2C」のように，複数の型が同時に現れる複合的な場．
\end{description}

実験では，1〜6のサブタイプまでの15個の型を「基本型」とし，評価指標の「基本ラベル」に用いる．一方で複合的な型は評価に含めない設定とした（詳細の定義は参考文献\cite{吉野2002日本の気候}を参照）．

\subsection{SOM設定と学習条件}
\begin{itemize}
\item マップサイズ：$10\times 10$
\item 反復回数：$1000$，バッチサイズ：$128$
\item 近傍関数：ガウス，初期$\sigma=2.5$（学習全体で減衰）
\item 学習率：$0.5$
\end{itemize}

\subsection{評価指標}
\begin{itemize}
\item Macro Recall（基本ラベル）：各基本ラベルの再現率の平均．混同行列は「基本ラベル vs クラスタ列」で集計．
\item NodewiseMatchRate（基本）：各ノードの多数決（基本ラベル）とtrue medoidの基本ラベルの一致率．
\end{itemize}
学習期および独立検証期に対して算出する．

\section{実験結果（実装出力に基づく記述）}


\section{考察}
\subsection{手法の特性と補完性}
S1は勾配差の比率に基づき前線帯や冬型で有効．SSIM5は局所構造（形状・位置・コントラスト）を評価．GSSIMは勾配強度と方向の両面を重み付きで評価．KAPPAは等圧面の曲率構造に注目する．複合（S1,KA／GS,KA／S1,GS,KA）はこれらの利点をRMS統合で併合し，BMU探索における汎化を支える．

\subsection{Medoid表現の有効性}
centroidは平均化により勾配が平滑化されやすい一方，medoidは実データ実現値を代表として保持し，解釈性と検索性を高める．本実装はノード内総距離最小（true medoid）を標準で算出する．

\section{まとめ}
GPU最適化Batch-SOM上で，既存手法（S1，SSIM5，EUCLIDEAN）と提案手法（KAPPA，GSSIM，S1,KA，GS,KA，S1,GS,KA）の8手法を同一条件で比較できる実験枠組みを構築した．実装に準拠した厳密な数式定義を提示し，評価は基本ラベルに対するMacro Recallとノード代表一致率で行った．centroidの代わりにmedoidを採用することで代表パターンの鋭さを保持できる．今後は多変量拡張，季節別最適化，および循環統計の総合評価（例：Jensen–Shannon距離）への発展を予定する．

\section*{付録：数式内の変数説明}
\begin{itemize}
\item $x,w$：入力パターンとノード重み（$H\times W$の格子場）
\item $\Omega$：格子領域の添字集合，$|\Omega|$は格子点数
\item $\mu_x(s),\mu_w(s)$：画素$s$近傍（5×5）での局所平均
\item $\sigma_x^2(s),\sigma_w^2(s)$：同局所分散
\item $\operatorname{cov}_{xw}(s)$：同局所共分散
\item $\Delta_x^\cdot,\Delta_y^\cdot$：水平方向・鉛直方向の一次差分
\item $g_x^\cdot,g_y^\cdot$：内部共通格子での勾配成分，$G^\cdot$：勾配強度
\item $\bm{n}$：正規化勾配ベクトル，$\kappa(z)=\nabla\cdot\bm{n}$（中心差分）
\item $\varepsilon$：数値安定化の微小正値（$10^{-12}$）
\end{itemize}

\bibliographystyle{sieicej}
\bibliography{ref}
\end{document}
